<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    <title>Eif pakeitimai</title>
    <meta name="author" content="David Bushell">
    <link rel="stylesheet" href="css/pikaday.css">
    <link rel="stylesheet" href="css/site.css">

    <style>
        input[type=text], input[type=password], select {
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        input[type=button] {
            width: 100%;
            background-color: #4CAF50;
            color: white;
            padding: 14px 20px;
            margin: 8px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button{
            width: auto;
            background-color: red;
            color: white;
            padding: 14px 20px;
            margin: 8px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }


        input[type=button]:hover {
            background-color: #45a049;
        }

        div {
            border-radius: 5px;
            background-color: #f2f2f2;
            padding: 20px;
        }

        .pagination {
            display: inline-block;
            margin-left: -22px;
        }

        .pagination a {
            color: black;
            float: left;
            padding: 8px 16px;
            text-decoration: none;
            transition: background-color .3s;
            border: 1px solid #ddd;
            margin: 0 4px;
        }

        .pagination a.active {
            background-color: #4CAF50;
            color: white;
            border: 1px solid #4CAF50;
        }

        .pagination a:hover:not(.active) {
            background-color: #ddd;
        }


        /* Create two unequal columns that floats next to each other */
        .column {
            float: left;

            /* Should be removed. Only for demonstration */
        }

        .left {
            width: 450px;
        }

        .right {
            margin-left: 50px;
            width: auto;
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }
        #pakeitimai {
            border-collapse: collapse;
            width: 100%;
        }


        #pakeitimai td, #pakeitimai th {
            border: 1px solid #ddd;
            font-size: 12pt;
        }

        #pakeitimai tr:nth-child(even){background-color: #f2f2f2;}

        #pakeitimai tr:hover {background-color: #ddd;}

        #pakeitimai th {

            text-align: left;
            font-size:20pt;
            background-color: #3f69b5;
            color: white;
        }



    </style>

</head>
<body>

<div class="row">
    <div class="column left">


            <form>


                <label for="datepicker">Pakeitimo data</label>
                <input type="text" id="datepicker" onchange="readAndDisplayData()">

                <label for="paskaita">Kelinta paskaita</label>
                <div class="pagination" id="paskaita">
                    <a href="#" class="active">1</a>
                    <a href="#">2</a>
                    <a href="#">3</a>
                    <a href="#">4</a>
                    <a href="#">5</a>
                    <a href="#">6</a>
                    <a href="#">7</a>
                    <a href="#">8</a>
                </div>
                <label for="grupe">Grupė</label>
                <input type="text" id="grupe" name="grupe" placeholder="Nurodykite grupė pvz: IS15S">
                <label for="auditorija">Auditorija</label>
                <input type="text" id="auditorija" name="auditorija" placeholder="auditorija pvz 402">
                <label for="destytojas">Destytojas</label>
                <input type="text" id="destytojas" name="destytojas" placeholder="M. Gzegozevskis">
                <input type="button" id="changes" value="Patvirtinti pakeitimą" onclick="myFunction()">
                <br/>
                <br/>
                <input style="background-color:red;" type="button" id="btnLogOut" value="Atsijungti" onclick="atsijungti()">
            </form>
        </div>



    <div class="column right">

        <table id="pakeitimai">


        </table>


        <div style="width:450px; margin:auto;" id="login">

            <form>
                <label for="prisijungimas">Prisijungimas</label>
                <input type="text" id="prisijungimas" name="prisijungimas" placeholder="" value="eif@viko.lt">
                <label for="slaptazodis">Slaptažodis</label>
                <input type="password" id="slaptazodis" name="slaptazodis" placeholder="iveskite slapazodi...">
                <input type="button" id="btnLogin" value="Prisijungti" onclick="prisijungti()">
            </form>
        </div>



    </div>
</div>




















<script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="pikaday.js"></script>


<script>















    $(".pagination a").click(function () {
        $('.pagination a').removeClass('active'); //Clear all checked class on .size
        $(this).addClass('active'); //Add checked class to current clicked .siz
    });



    // init picker

    var picker = new Pikaday(
        {
            field: document.getElementById('datepicker'),
            firstDay: 1,
            minDate: new Date(),
            maxDate: new Date(2070, 12, 31),
            yearRange: [2018, 2020]
        });


    // Initialize Firebase

    var config = {
        apiKey: "AIzaSyCRYVIHl_orktaBMwsmlQtMcOaeGO0FTQI",
        authDomain: "eif-courses.firebaseapp.com",
        databaseURL: "https://eif-courses.firebaseio.com",
        projectId: "eif-courses",
        storageBucket: "eif-courses.appspot.com",
        messagingSenderId: "535363326769"
    };
    firebase.initializeApp(config);

    $(function() {
        // Handler for .ready() called.

        const auth = firebase.auth();
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                $("#login").hide();
                //document.getElementById("btnLogOut").classList.remove('hide');
            } else {
                //document.getElementById("btnLogOut").classList.add('hide');
                $("#login").show();
            }
        });


    const playersRef = firebase.database().ref("user-posts/");

    playersRef.on('child_removed', snap => {

        console.log('KAZKAS ISTRINE ELEM');
        readAndDisplayData();

    });














    var remove = function(e){
        e.preventDefault();
       // e.stopPropogation();
       // var key = $(this).data('key');
        var destID = this.id;  // iraso id
        if(confirm('Ar tikrai norite ištrinti šį įrašą?')){


            //console.log(cc);
            var playersRef = firebase.database().ref("user-posts/");

            playersRef.once("value", function (data, prevChildKey) {
                playersRef.child(''+destID).remove()
                    .then(function () {
                        console.log("Remove succeeded.");
                        readAndDisplayData();

                    })
                    .catch(function (error) {
                        console.log("Remove failed: " + error.message)
                    });

            });
           // firebase.database().ref("movies").child(key).remove();
        }
    }
    $(document).on('click', '.btn-remove-key', remove);

    // DOCUMENT READY FUNKCIJA
    });





    //var pakeitimai = document.getElementById('pakeitimai');
    //var dbRef = firebase.database().ref().child('text');
    // dbRef.on('value', snap => pakeitimai.innerText = snap.val());

    function writeNewPost(date, destytojas, auditorija, grupe, paskaita) {
        // A post entry.
        var postData = {
            date: date,
            destytojas: destytojas,
            auditorija: auditorija,
            grupe: grupe,
            starCount: 0,
            paskaita: paskaita
        };

        // Get a key for a new Post.
        var newPostKey = firebase.database().ref().child('archive').push().key;

        // Write the new post's data simultaneously in the posts list and the user's post list.
        var updates = {};
        updates['/archive/' + newPostKey] = postData;
        updates['/user-posts/' + newPostKey] = postData;

        return firebase.database().ref().update(updates);
    }

    function deleteFromList(pakeitimo_id) {
        console.log(pakeitimo_id);
        // init remove event
        var playersRef = firebase.database().ref("user-posts/").child('' + picker.toString('YYYY-MM-DD'));

        playersRef.once("value", function (data, prevChildKey) {
            playersRef.child(pakeitimo_id).remove()
                .then(function () {
                    console.log("Remove succeeded.");
                    readAndDisplayData();

                })
                .catch(function (error) {
                    console.log("Remove failed: " + error.message)
                });

        });

    }






    function readAndDisplayData() {

        document.getElementById("pakeitimai").innerHTML = '<th>Paskaita</th>'+'<th>Grupė</th>'+'<th>Dėstytojas</th>'+'<th>Auditorija</th>'+'<th colspan="2">Data</th>';
        var playersRef = firebase.database().ref("user-posts/");


        playersRef.orderByChild("paskaita").on("child_added", function (data, prevChildKey) {
            var newPlayer = data.val();

            var pakeitimaiDiv = document.getElementById("pakeitimai");
           // pakeitimaiDiv.innerHTML += newPlayer.paskaita + ' ' + newPlayer.grupe + ' ' + newPlayer.destytojas + ' ' + newPlayer.auditorija + ' ' + newPlayer.date + ' ' + '<button type="button" class="btn-remove-key" data-key="-dsdsf-sample-key"'+ 'id="'+data.key+'"> Ištrinti'+'</button><br/>' + '\n';
            pakeitimaiDiv.innerHTML += '<tr><td>'+newPlayer.paskaita + '</td><td>' + newPlayer.grupe + '</td><td>' + newPlayer.destytojas + '</td><td>' + newPlayer.auditorija + '</td><td> ' + newPlayer.date + '</td><td>' + '<button type="button" class="btn-remove-key" data-key="-dsdsf-sample-key"'+ 'id="'+data.key+'"> Ištrinti'+'</button></td></tr>' + '\n';

        });


//        $("button#" + data.key).click(function () {
//
//            deleteMessages('' + $("button#" + data.key).text());
//            alert("Handler for .click() called." + $("button#" + data.key).text());
//            console.log('HELOOOOOOOOOOOOOOOOOOOOOO' + $("button#" + data.key).text());
//        });

    }


    function showCurrentChanges() {


        var playersRef = firebase.database().ref("user-posts/");


        $("#del").click(function () {
            playersRef.on("child_added", function (data, prevChildKey) {
                if ($("#del").text() === data.key) {

                    playersRef.child(data.key).remove()
                        .then(function () {
                            console.log("Remove succeeded.");
                            readAndDisplayData();

                        })
                        .catch(function (error) {
                            console.log("Remove failed: " + error.message)
                        });
                }

            });

        });
    }
    function myFunction() {

        var auditorija = document.getElementById("auditorija").value;
        var destytojas = document.getElementById("destytojas").value;
        var grupe = document.getElementById("grupe").value;
        var paskaita = $('div#paskaita.pagination a.active').text(); //document.getElementById("paskaita").value;
        var data = picker.toString('YYYY-MM-DD');
        writeNewPost(picker.toString('YYYY-MM-DD'), destytojas, auditorija, grupe, paskaita);

        //alert(picker.toString('YYYY-MM-DD'));
        readAndDisplayData();
        // ...


    }


</script>

<script>

    function prisijungti() {

        document.getElementById("btnLogin").addEventListener('click', e => {
            const email = document.getElementById("prisijungimas").value;
            const pass = document.getElementById("slaptazodis").value;
            const promise = firebase.auth().signInWithEmailAndPassword(email, pass);
            console.log('logged in');

            promise.catch(e => {
                console.log(e.massage)
            });
        });
    }

    function atsijungti() {
        document.getElementById("btnLogOut").addEventListener('click', e => {
            firebase.auth().signOut();
            console.log('logged out');
        });
    }
</script>


</body>
</html>
